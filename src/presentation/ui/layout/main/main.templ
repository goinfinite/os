package uiLayout

import (
	_ "embed"
	"github.com/goinfinite/os/src/domain/valueObject/helper"
	componentUtil "github.com/goinfinite/os/src/presentation/ui/component/util"
	layoutFooter "github.com/goinfinite/os/src/presentation/ui/layout/footer"
	layoutSidebar "github.com/goinfinite/os/src/presentation/ui/layout/sidebar"
	uiImport "github.com/goinfinite/ui/src/import"
	"os"
)

//go:embed state.js
var mainLayoutAlpineState string

templ HeadTag() {
	<head>
		<title>Infinite OS</title>
		<meta charset="utf-8"/>
		<meta name="robots" content="noindex"/>
		<link rel="icon" type="image/ico" href="/assets/favicon.ico"/>
		<script src="/assets/additional.js"></script>
		@uiImport.HeadTagsFull()
		<link rel="stylesheet" type="text/css" href="/assets/additional.css"/>
		<script src="https://cdn.jsdelivr.net/npm/vega@5.31.0/build/vega.min.js" integrity="sha256-cYdMz6q7m7D3OhasQJRy1/5Th1YCEncQpVT0dz1Zmjc=" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/vega-lite@5.23.0/build/vega-lite.min.js" integrity="sha256-WMJzWOJvLTGc9i9FvBekyDYvCGRQAd8uyNNB7uQJfH8=" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/vega-embed@6.29.0/build/vega-embed.min.js" integrity="sha256-EtAqz74+xZ75o33UgiouBOKWG1u7Zxu+Zh0iIXFbmdo=" crossorigin="anonymous"></script>
	</head>
}

type MainLayoutSettings struct {
	PageContent templ.Component
}

templ Main(componentSettings MainLayoutSettings) {
	<!DOCTYPE html>
	<html>
		@HeadTag()
		<!-- MainLayout JavaScript -->
		@templ.Raw(`<script type="text/javascript">` + mainLayoutAlpineState + `</script>`)
		if isDevMode, _ := voHelper.InterfaceToBool(os.Getenv("DEV_MODE")); isDevMode {
			@templ.JSFuncCall("devWsHotReload")
		}
		<!-- MainLayout HTML -->
		<body class="bg-primary-500 flex overflow-hidden text-neutral-50">
			@componentUtil.LoadingOverlay()
			@layoutSidebar.Sidebar()
			<!-- PageContent -->
			<section id="page-content" class="h-screen w-full overflow-y-auto overflow-x-hidden p-6">
				@componentSettings.PageContent
			</section>
			@layoutFooter.FooterSkeleton()
			@componentUtil.Toast()
		</body>
	</html>
}
